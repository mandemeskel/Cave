<!DOCTYPE html>
<html>
    
    <head>
        <meta charset=utf-8 />

        <link rel="stylesheet" type="text/css" href="static/style.css">

        <title>Cave</title>
    </head>
    
    <body style="background-color:black;">
      
      <button onclick="init();" > newmap </button>
      <button onclick="toggleMap();" > toggle map </button>
      <button onclick=" player.prev.copy(player.pos); player.pos.set(200, 200); player.draw = true;" >
           reset position(unstuck) </button>

        <!-- next level dialog box -->
        <div id="nextLvlToast" class="toast invis">
            <p class="title">Paused</p>
            <p>Go to the next level?</p>
            <button onclick="handelNextLvl( true )"> Yes </button>
            <button onclick="handelNextLvl( false )"> No </button>
        </div>
          
          
         <!--- dead player dialog box -->
        <div id="deadToast" class="toast invis">
            <p class="title">Death...</p>
            <p>You have fallen to your doom, play again?</p>
            <button onclick="handelDeath( true )"> Yes </button>
            <button onclick="handelDeath( false )"> No </button>
        </div>
          
        <!-- start -->
        <div id="introToast" class="toast ">
            <p class="title">Cave</p>
              
            <p class="info" > 
              <b> W </b> - Jump/Climb up when next to a wall
            <br>
              <b> A </b> - Move left/Stop climbing
            <br>
              <b> S </b> - Climb down when over an edge
            <br>
              <b> D </b> - Move right/Stop climbing
            <br>
              <b> RMB </b> - Use exit to lleave cave
            <br>
              <b> MOUSE </b> - Move mouse to move light cone
            <br>
            <br>
                Go forth and explore but becarefull steep falls can kill you. Once you have
              explored one cave go back into the entrace ( the yellow box ) and click on it to lleave.
            </p>
            
            <button onclick="init();"> Start </button>
        </div>
                  
    </body>

    <script type="text/javascript"> 
        //these are helper functions and classes
        var PI = Math.PI,
            _90 = PI*0.5,
            _180 = PI,
            _270 = PI*1.5,
            _360 = PI*2;
            
        //this class handles all locations on the canvas
        function Vector(x, y) {
          this.x = x;
          this.y = y;
        }
        
        Vector.prototype.offset = function(x, y) {
          this.x += x;
          this.y += y;
        };
        
        Vector.prototype.set = function(x, y) {
          this.x = x;
          this.y = y;
        };
            
        Vector.prototype.addV = function(v) {
          this.x += v.x;
          this.y += v.y;
        };
        
        Vector.prototype.subV = function(v) {
          this.x -= v.x;
          this.y -= v.y;
        };
        
        Vector.prototype.copy = function(v) {
          this.x = v.x;
          this.y = v.y;
        };
        
        Vector.prototype.distanceTo = function(v) {
            return Math.sqrt( Math.pow( (v.x - this.x), 2 ) + 
                                Math.pow( (v.y - this.y), 2 ) );
        };
        
        Vector.prototype.equals = function(v) {
            return ( this.x == v.x ) && ( this.y == v.y);
        };
        
        //gets angle from mouse position, obj is the player
        function getAngle( obj, mouse ){
           var angle,
             ox = obj.pos.x - mouse.x,
             oy = obj.pos.y - mouse.y;
          
         if( ox !== 0 ){
            angle = toDegrees( Math.atan( oy/ox ) );
        
            if( ox > 0 && oy > 0){
                angle += 180;
            }else if( ox < 0 && oy > 0 ) {
                angle += 360;
            }else if( ox < 0 && oy < 0 ) {
                angle = angle;
            }else if( ox > 0 && oy < 0 ) {
                angle += 180 ;
            }else{
              angle = ox > 0 ? 180 : 0; 
            }
            
          } else {
            if(oy > 0){
              angle = 270;
            } else {
              angle = 90;
            }
          }
          
          return angle;
        }

        //gets mouse cords relative to the location of the canvas on the html body
        function getCords( cnvs, mx, my ){
            var bound = cnvs.getBoundingClientRect();
            var v = new Vector( mx - bound.left * (cnvs.width / bound.width),
                                my - bound.top * (cnvs.height / bound.height) );
            //v.subV( offset );
            return v;
        }
        
        function toRadians( angle ) {
          return angle * ( PI / 180 );
        }
        
        function toDegrees( angle ) {
          return angle * ( 180 / PI );
        }
        
        function getQuad( angle, inrad ) {
            var q = 0;
            if( inrad ) angle = toDegrees( angle );
            if( 0 < angle && angle < 90 ) {
                q = 1;
            } else if( 90 < angle && angle < 180 ) {
                q = 2;
            } else if( 180 < angle && angle < 270 ) {
                q = 3;
            } else if( 270 < angle && angle < 360 ) {
                q = 4;
            } else {
                q = 5;
            }
            return q;
        }
        
        function toggleMap(){
          draw_map = !draw_map;
          if( draw_map ) {
            document.body.style.background = "blue";
          } else {
            document.body.style.background = "black";
          }
        }
        
        //handels player response for death toast dialog 
        function handelDeath( yes ) {
            if( yes ) {
                init();
            } else {
                ctx.clearRect( 0, 0, w, h );
                document.getElementById( "introToast" ).className = "toast";
            }
            document.getElementById( "deadToast" ).className = "invis";
        }
        
        //handels player response for next level toast dialog 
        function handelNextLvl( yes ) {
            if( yes ) init();
            document.getElementById( "nextLvlToast" ).className = "invis";
        }
        
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

    </script>
    
    <script type="text/javascript" src="js/map.js"></script>  
    <script type="text/javascript" src="js/ray.js"></script>
    <script type="text/javascript" src="js/game.js"></script> 
    
</html>